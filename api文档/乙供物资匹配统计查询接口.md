# 乙供物资匹配统计查询接口

## 接口基本信息

- **接口名称**: 乙供物资匹配统计查询
- **接口路径**: `/materials/partyb/getMaterialMatchingStats`
- **请求方式**: GET
- **接口版本**: v6
- **所属模块**: 乙供物资管理模块

## 接口描述

本接口用于查询指定任务中乙供物资的匹配统计信息，包括精确匹配数量、未匹配价格数量、待匹配数量等关键统计数据。

## 请求参数

| 参数名 | 类型   | 必填 | 描述       | 示例值        |
| ------ | ------ | ---- | ---------- | ------------- |
| taskId | String | 是   | 物资任务ID | "task_123456" |

## 响应参数

### 成功响应

**HTTP状态码**: 200

**响应体结构**:

```json
{
  "totalMaterials": 100,
  "exactMatchCount": 60,
  "unmatchedPriceCount": 15,
  "pendingMatchCount": 25
}
```

**字段说明**:

| 字段名              | 类型 | 描述                                                     |
| ------------------- | ---- | -------------------------------------------------------- |
| totalMaterials      | Long | 物资总数                                                 |
| exactMatchCount     | Long | 精确匹配且价格匹配的数量                                 |
| unmatchedPriceCount | Long | 精确匹配但价格未匹配的数量                               |
| pendingMatchCount   | Long | 待匹配的数量（包含相似匹配、历史匹配、人工匹配、无匹配） |

### 错误响应

**HTTP状态码**: 400

```json
{
  "timestamp": "2024-01-01T12:00:00",
  "status": 400,
  "error": "Bad Request",
  "message": "任务ID不能为空",
  "path": "/v2/materials/party-b/getMaterialMatchingStats"
}
```

**HTTP状态码**: 500

```json
{
  "timestamp": "2024-01-01T12:00:00",
  "status": 500,
  "error": "Internal Server Error",
  "message": "查询物资匹配统计信息失败",
  "path": "/v2/materials/party-b/getMaterialMatchingStats"
}
```

## 接口调用示例

### 请求示例

```bash
curl -X GET "http://localhost:1207/v2/materials/party-b/getMaterialMatchingStats?taskId=task_123456"
```

### 响应示例

```json
{
  "totalMaterials": 150,
  "exactMatchCount": 85,
  "unmatchedPriceCount": 20,
  "pendingMatchCount": 45
}
```

## 业务逻辑说明

### 统计规则

1. **精确匹配数量 (exactMatchCount)**:

   - 匹配类型为精确匹配（comparison_result = 1）
   - 且存在价格匹配记录（price_matched_status = 1）

2. **未匹配价格数量 (unmatchedPriceCount)**:

   - 匹配类型为精确匹配（comparison_result = 1）
   - 但不存在价格匹配记录

3. **待匹配数量 (pendingMatchCount)**:
   - 匹配类型为相似匹配（2）、历史匹配（3）、人工匹配（4）、无匹配（0）
   - 或匹配类型为空

### 数据来源

- 主表: `wmes_y_materail_task_data` (乙供物资任务数据表)
- 关联表: `wmes_y_materail_matched_result` (乙供物资匹配结果表)

## 性能考虑

- 接口使用原生SQL查询，性能优化
- 统计计算在数据库层面完成，减少应用层处理
- 支持大数据量的统计查询

## 版本历史

| 版本 | 日期       | 描述                           |
| ---- | ---------- | ------------------------------ |
| v6   | 2024-09-02 | 初始版本，提供物资匹配统计功能 |

## 相关接口

- [乙供物资复杂查询接口](../v3/乙供物资复杂查询接口.md)
- [物资基础信息包含价格数据分页查询接口](../v3/物资基础信息包含价格数据分页查询接口.md)
- [训练数据统计接口](../v5/训练数据统计接口.md)

## 注意事项

1. 任务ID必须为有效的物资任务ID
2. 接口返回的统计数量均为实际匹配状态的数量
3. 如果任务不存在或没有数据，返回各统计字段为0
4. 接口支持并发调用，但建议合理控制调用频率
