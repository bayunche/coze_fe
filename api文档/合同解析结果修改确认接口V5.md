# 合同解析结果修改确认接口 V5

## 接口基本信息

- **接口路径**: `api/contract/analysis-results/update`
- **请求方式**: POST
- **接口版本**: v5
- **功能描述**: 修改并确认合同解析结果，支持记录修改原因
- **变更说明**: 在v3版本基础上增加modificationReason字段

## 请求参数

### 请求体 (application/json)

```json
{
  "taskDetailId": "a13161390c1d41b8a61f8215d17bc157",
  "resultStatus": 1,
  "fieldData": [
    {
      "columnCode": "contract_name",
      "columnName": "合同名称", 
      "columnValue": "修改后的合同名称"
    },
    {
      "columnCode": "contract_amount",
      "columnName": "合同金额",
      "columnValue": "1200000.00"
    }
  ],
  "remark": "人工修正解析结果",
  "operator": "张三",
  "modificationReason": "修正AI识别错误"
}
```

### 参数说明

| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| taskDetailId | string | 是 | 任务详情ID | `a13161390c1d41b8a61f8215d17bc157` |
| resultStatus | integer | 是 | 结果状态(1=已确认) | `1` |
| fieldData | array | 是 | 要修改的字段数据列表 | - |
| remark | string | 否 | 操作备注 | `人工修正解析结果` |
| operator | string | 否 | 操作人姓名 | `张三` |
| modificationReason | string | 否 | **新增** 修改原因说明 | `修正AI识别错误` |

### fieldData字段说明

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| columnCode | string | 是 | 字段编码 |
| columnName | string | 是 | 字段名称 |
| columnValue | string | 是 | 字段值 |

## 响应

### 成功响应 (application/json)

```json
{
  "success": true,
  "message": "更新成功",
  "data": {
    "updatedCount": 2,
    "createdCount": 0,
    "failedFields": {},
    "taskDetailId": "a13161390c1d41b8a61f8215d17bc157"
  },
  "timestamp": "2024-08-27T09:00:00"
}
```

### 响应字段说明

| 字段名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 操作是否成功 |
| message | string | 操作结果消息 |
| data.updatedCount | number | 更新的字段数量 |
| data.createdCount | number | 新增的字段数量 |
| data.failedFields | object | 失败的字段及原因 |
| data.taskDetailId | string | 任务详情ID |
| timestamp | string | 响应时间戳 |

### 错误响应
```json
{
  "success": false,
  "message": "任务详情ID不能为空",
  "timestamp": "2024-08-27T09:00:00"
}
```

## 使用示例

### cURL示例
```bash
curl -X POST "http://localhost:1207/api/contract/analysis-results/update" \
  -H "Content-Type: application/json" \
  -d '{
    "taskDetailId": "a13161390c1d41b8a61f8215d17bc157",
    "resultStatus": 1,
    "fieldData": [
      {
        "columnCode": "contract_name",
        "columnName": "合同名称",
        "columnValue": "某某项目施工合同"
      }
    ],
    "remark": "规范合同名称",
    "operator": "李四",
    "modificationReason": "合同名称识别不准确"
  }'
```

### JavaScript示例
```javascript
// 使用axios调用
const response = await axios.post('/api/contract/analysis-results/update', {
  taskDetailId: 'a13161390c1d41b8a61f8215d17bc157',
  resultStatus: 1,
  fieldData: [
    {
      columnCode: 'contract_amount',
      columnName: '合同金额',
      columnValue: '1500000.00'
    }
  ],
  remark: '调整合同金额',
  operator: '王五',
  modificationReason: '金额计算有误'
});

console.log('更新结果:', response.data);
```

## 修改记录流程

### 1. 字段更新
- 存在则更新字段值
- 不存在则创建新字段
- 记录修改前后的值对比

### 2. 日志记录
```java
// 系统会自动记录修改日志
modificationLogService.logFieldModification(
    "contract", 
    taskDetailId, 
    columnCode,
    columnName, 
    oldValue, 
    newValue,
    operator, 
    remark,
    modificationReason  // 新增参数
);
```

### 3. 质量评分
- 系统自动计算修改记录的质量评分
- 修改原因字段贡献0.15分权重
- 影响后续训练数据筛选

## 修改原因的重要性

### 对模型训练的价值
1. **提供上下文**: 帮助理解修改的动机和背景
2. **错误分析**: 识别AI模型的常见错误模式
3. **规则挖掘**: 从修改原因中提取业务规则
4. **质量评估**: 作为数据质量的重要指标

### 建议的修改原因
- `修正AI识别错误` - 模型识别不准确
- `规范业务术语` - 统一命名规范
- `补充缺失信息` - 添加模型未识别的信息
- `调整数据格式` - 标准化数据格式
- `纠正计算错误` - 修正数值计算错误

## 版本变更说明

### v5 → v3 变化
1. **新增字段**: 增加 `modificationReason` 修改原因字段
2. **增强日志**: 修改原因会记录到操作日志中
3. **质量提升**: 修改原因参与质量评分计算
4. **训练优化**: 为模型训练提供更丰富的上下文信息

## 相关接口

- [人工修改记录训练数据导出接口](./人工修改记录训练数据导出接口.md)
- [训练数据统计接口](./训练数据统计接口.md)
- [合同解析结果批量确认接口](../v3/合同解析结果批量确认接口.md)

## 最佳实践

1. **必填修改原因**: 建议要求用户必须填写修改原因
2. **原因分类**: 提供预定义的修改原因选项
3. **质量监控**: 定期分析修改原因分布
4. **模型反馈**: 将修改原因反馈给AI模型优化