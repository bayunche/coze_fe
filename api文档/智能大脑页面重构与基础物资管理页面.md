# 智能大脑页面重构与基础物资管理页面设计规范

## 目录
- [智能大脑页面功能设计（页面化重构）](#智能大脑页面功能设计页面化重构)
- [基础物资管理页面功能设计](#基础物资管理页面功能设计)

---

## 🧠 智能大脑页面功能设计（页面化重构）

该页面为原"智能大脑弹窗"功能的完整重构版，现作为独立页面使用，分为**管理员视角**和**普通用户视角**两种权限显示。

### 🔐 权限控制概览

| 功能模块      | 管理员          | 普通用户           |
| --------- | ------------ | -------------- |
| 查看所有智能体卡片 | ✅ 是          | ✅ 是            |
| 查看任务总览数据  | ✅ 是（所有智能体）   | ✅ 是（仅限本人任务）    |
| 查看任务详情弹窗  | ✅ 是（所有任务）    | ✅ 是（仅限本人任务）    |
| 管理入口功能卡片  | ✅ 是          | ❌ 否            |
| 操作记录查看    | ✅ 是（所有已完成任务） | ✅ 是（仅限本人已完成任务） |

### 🧭 页面结构概览

#### 1. 顶部信息区
- 左侧标题：🧠 智能大脑
- 右侧身份标签（如：管理员 / 普通用户）

#### 2. 总览数据卡片区
- 横向显示系统任务数据汇总（管理员可见全部，用户仅限本人任务）
- 数据字段包括：
  - 总任务数
  - 进行中任务
  - 已完成任务

#### 3. 智能体监控区
- 每个智能体为一个卡片
- 展示内容：
  - 智能体名称
  - 在线状态（始终为在线）
  - 各项任务数（横排显示）
- 卡片可点击，打开详情弹窗

#### 4. 任务详情弹窗
- 任务表格分页展示：
  - 任务编号、创建时间、状态、进度
- 状态分类标签页：全部 / 进行中 / 已完成
- 进度展示：任务处理进度条
- 操作项：查看任务详情（或后续扩展）

#### 5. 管理功能入口区（仅管理员可见）
- 卡片式管理入口：
  - ✅ 物资名称管理页面
  - ✅ 向量库数据管理页面

#### 6. 历史操作记录区
- 查看所有或本人任务的执行记录（按权限控制）

### 🧩 智能体配置明细

| 智能体名称    | 业务域标识     | 工作流ID              | 区分方式 |
| -------- | --------- | ------------------- | ---- |
| 合同解析     | contract  | 7516796514431172642 | 固定   |
| 乙供物资解析   | y_material | 7517934954761715721 | 固定   |
| 甲供物资解析   | j_material | 7517934954761715721 | 参数区分 |

### 🔄 数据流与交互流程

#### 页面加载时
1. 进入页面自动调用 `handleSmartBrain()`
2. 并发请求：
   - 获取所有智能体任务总览数据
   - 拉取每个智能体的任务列表详情
3. 更新状态管理对象（如 `smartAgents` 和 `taskListsByAgent`）

#### 用户交互流程
- 进入页面 → 查看智能体卡片
- 点击卡片 → 打开任务详情弹窗
- 浏览任务 → 查看状态 / 操作记录

---

## 📦 基础物资管理页面功能设计

该页面为智能大脑管理功能的子页面，提供完整的物资信息管理功能，包含数据展示、编辑操作和批量导入导出等核心功能。

### 🔐 权限控制

| 功能模块 | 管理员 | 普通用户 |
|---------|--------|----------|
| 查看物资列表 | ✅ 是 | ❌ 否 |
| 新增物资 | ✅ 是 | ❌ 否 |
| 修改物资 | ✅ 是 | ❌ 否 |
| 删除物资 | ✅ 是 | ❌ 否 |
| 导入物资 | ✅ 是 | ❌ 否 |
| 导出物资 | ✅ 是 | ❌ 否 |

### 🏗️ 页面结构设计

#### 1. 顶部操作区
```
📦 基础物资管理                    [返回智能大脑] [导入] [导出] [+ 新增物资]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

- **左侧标题**：📦 基础物资管理
- **右侧操作按钮**：
  - 返回智能大脑（面包屑导航）
  - 导入按钮
  - 导出按钮  
  - 新增物资按钮

#### 2. 筛选条件区
```
年份: [2024 ▼]    季度: [Q1 ▼]    物资名称: [搜索框]    [查询] [重置]
```

- **年份选择器**：下拉选择（2020-2030）
- **季度选择器**：Q1/Q2/Q3/Q4
- **物资名称搜索**：支持模糊搜索
- **查询/重置按钮**

#### 3. 数据统计卡片
```
┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│   总物资数   │ │  当前季度   │ │  平均价格   │ │  最近更新   │
│    1,258    │ │   2024Q1   │ │  ¥2,456    │ │ 2024-03-15 │
└─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘
```

#### 4. 物资列表表格
| 序号 | 物资名称 | 规格型号 | 物资价格 | 价格季度 | 创建时间 | 更新时间 | 操作 |
|------|----------|----------|----------|----------|----------|----------|------|
| 1 | 水泥 | 425# | ¥350.00 | 2024Q1 | 2024-01-15 | 2024-03-10 | [编辑] [删除] |
| 2 | 钢筋 | HRB400 Φ12 | ¥4,200.00 | 2024Q1 | 2024-01-20 | 2024-02-28 | [编辑] [删除] |

**表格功能**：
- 支持分页显示（每页50条）
- 支持按列排序
- 支持批量选择删除

### 🪟 弹窗设计

#### 1. 新增/编辑物资弹窗
```
┌─────────────────────────────────────────┐
│  ✏️ 新增物资 / 编辑物资                    │
├─────────────────────────────────────────┤
│  年份: [2024 ▼] *必填                    │
│  季度: [Q1 ▼]   *必填                    │  
│  物资名称: [________________] *必填       │
│  规格型号: [________________] *必填       │
│  物资价格: [________________] *必填       │
│            (¥，保留2位小数)              │
├─────────────────────────────────────────┤
│                    [取消] [确定]         │
└─────────────────────────────────────────┘
```

**表单验证规则**：
- 年份：必填，范围2020-2030
- 季度：必填，Q1/Q2/Q3/Q4
- 物资名称：必填，长度2-50字符
- 规格型号：必填，长度2-100字符
- 物资价格：必填，数字格式，大于0

#### 2. 批量导入弹窗
```
┌─────────────────────────────────────────┐
│  📤 批量导入物资                          │
├─────────────────────────────────────────┤
│  年份: [2024 ▼] *必填                    │
│  季度: [Q1 ▼]   *必填                    │
│                                         │  
│  选择文件: [选择Excel文件] 📎            │
│           支持.xlsx,.xls格式             │
│                                         │
│  📋 导入模板下载                         │
│  [下载导入模板]                          │
├─────────────────────────────────────────┤
│                    [取消] [开始导入]     │
└─────────────────────────────────────────┘
```

#### 3. 批量导出弹窗
```
┌─────────────────────────────────────────┐
│  📥 批量导出物资                          │
├─────────────────────────────────────────┤
│  年份: [2024 ▼] *必填                    │
│  季度: [Q1 ▼]   *必填                    │
│                                         │
│  导出格式: ○ Excel (.xlsx)               │
│           ○ CSV (.csv)                  │
│                                         │
│  导出范围: ○ 当前筛选结果                │
│           ○ 全部数据                    │
├─────────────────────────────────────────┤
│                    [取消] [开始导出]     │
└─────────────────────────────────────────┘
```

### 📊 数据结构设计

#### 物资信息数据模型
```javascript
{
  id: "物资ID",
  materialName: "物资名称",
  specification: "规格型号", 
  price: "物资价格(元)",
  priceQuarter: "价格季度(YYYY-QX)",
  year: "年份",
  quarter: "季度",
  createTime: "创建时间",
  updateTime: "更新时间",
  creator: "创建人",
  updater: "更新人"
}
```

#### 导入Excel模板格式
| 物资名称* | 规格型号* | 物资价格* |
|-----------|-----------|-----------|
| 水泥 | 425# | 350.00 |
| 钢筋 | HRB400 Φ12 | 4200.00 |

### 🔄 交互流程设计

#### 1. 页面加载流程
```
进入页面 → 获取默认筛选条件(当前年份季度) → 调用物资列表API → 渲染数据表格
```

#### 2. 新增物资流程
```
点击新增按钮 → 打开新增弹窗 → 填写表单 → 表单验证 → 调用新增API → 刷新列表
```

#### 3. 编辑物资流程
```
点击编辑按钮 → 打开编辑弹窗(回填数据) → 修改表单 → 表单验证 → 调用编辑API → 刷新列表
```

#### 4. 批量导入流程
```
点击导入按钮 → 打开导入弹窗 → 选择年份季度 → 上传Excel文件 → 
文件验证 → 调用导入API → 显示导入结果 → 刷新列表
```

#### 5. 批量导出流程
```
点击导出按钮 → 打开导出弹窗 → 选择年份季度和格式 → 
调用导出API → 下载文件
```

### 🎨 UI细节规范

#### 色彩规范
- **主色调**：蓝色系 (#1890ff)
- **成功色**：绿色 (#52c41a)  
- **警告色**：橙色 (#faad14)
- **危险色**：红色 (#ff4d4f)

#### 按钮规范
- **主要按钮**：蓝色背景，白色文字
- **次要按钮**：白色背景，蓝色边框
- **危险按钮**：红色背景，白色文字

#### 表格规范
- **表头**：灰色背景 (#fafafa)
- **行高**：48px
- **分页**：底部居中显示
- **排序**：支持点击表头排序

### 🚀 技术实现要点

#### 1. 状态管理
```javascript
const [materialList, setMaterialList] = useState([]);
const [loading, setLoading] = useState(false);
const [searchParams, setSearchParams] = useState({
  year: new Date().getFullYear(),
  quarter: getCurrentQuarter(),
  materialName: ''
});
const [pagination, setPagination] = useState({
  current: 1,
  pageSize: 50,
  total: 0
});
```

#### 2. API接口规划
- `GET /api/materials` - 获取物资列表
- `POST /api/materials` - 新增物资
- `PUT /api/materials/:id` - 编辑物资  
- `DELETE /api/materials/:id` - 删除物资
- `POST /api/materials/import` - 批量导入
- `GET /api/materials/export` - 批量导出

#### 3. 导入导出处理
- 使用 `xlsx` 库处理Excel文件
- 支持拖拽上传和点击上传
- 导入前进行数据格式验证
- 导出支持Excel和CSV格式

---

## 📝 开发注意事项

### 路由配置
- 智能大脑页面：`/smart-brain`
- 基础物资管理页面：`/smart-brain/material-management`

### 权限验证
- 所有页面需要进行用户权限验证
- 管理员权限控制通过角色判断
- 普通用户仅能查看自己的任务数据

### 响应式设计
- 支持桌面端和移动端适配
- 表格在移动端采用卡片式展示
- 弹窗在移动端全屏显示

### 性能优化
- 表格数据采用虚拟滚动
- 图片和文件上传支持压缩
- API请求支持防抖和节流
- 使用React.memo优化组件渲染

### 错误处理
- 网络请求异常处理
- 文件上传格式验证
- 表单数据校验
- 用户友好的错误提示