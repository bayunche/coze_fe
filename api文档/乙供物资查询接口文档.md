# 乙供物资查询接口文档 (v1.1.0)

## 接口说明

本接口用于查询乙供物资的解析结果，支持分页、筛选和搜索功能。接口返回完整的物资信息、价格信息和匹配选项。

## 请求地址

```
POST /api/materials/partyb/query
```

## 请求参数

| 参数名 | 类型 | 必填 | 说明 |
| --- | --- | --- | --- |
| taskId | String | 是 | 任务ID |
| page | Integer | 否 | 页码（从0开始），默认值：0 |
| size | Integer | 否 | 每页大小，默认值：10 |
| keyword | String | 否 | 搜索关键词 |
| confirmResult | Integer | 否 | 确认结果筛选（0：未确认，1：已确认，不传则查询全部） |
| matchedType | Integer | 否 | 匹配类型筛选（0：无匹配，1：精确匹配，2：相似匹配，3：历史匹配，4：人工匹配，不传则查询全部） |
| matchingStatus | Integer | 否 | 匹配状态筛选（1：精确匹配且价格匹配，2：精确匹配但价格未匹配，3：待处理匹配，不传则查询全部） |

## 响应参数

### 成功响应

```json
{
  "content": [
    {
      "taskDataId": "string",
      "taskId": "string",
      "taskDetailId": "string",
      "materialName": "string",
      "specifications": "string",
      "unit": "string",
      "quantity": "string",
      "unitPrice": "string",
      "taxPrice": "string",
      "totalPrice": "string",
      "confirmResult": 0,
      "confirmBaseDataId": "string",
      "confirmPriceId": "string",
      "confirmType": 0,
      "matchedType": 0,
      "originalPrice": "string",
      "taxExcludedPrice": "string",
      "priceType": 0,
      "createdTime": "2025-01-01T00:00:00",
      "updatedTime": "2025-01-01T00:00:00",
      "baseInfo": {
        "baseDataId": "string",
        "materialName": "string",
        "specifications": "string",
        "unit": "string",
        "serialNumber": "string",
        "priceCode": "string",
        "materialCode": "string",
        "type": "string"
      },
      "priceInfo": {
        "priceId": "string",
        "baseDataId": "string",
        "taxPrice": "string",
        "quarter": "string"
      },
      "matchOptions": [
        {
          "matchResultId": "string",
          "matchedId": "string",
          "matchScore": 0,
          "matchType": 0,
          "baseInfo": {
            "baseDataId": "string",
            "materialName": "string",
            "specifications": "string",
            "unit": "string",
            "serialNumber": "string",
            "priceCode": "string",
            "materialCode": "string",
            "type": "string"
          },
          "priceOptions": [
            {
              "priceId": "string",
              "baseDataId": "string",
              "taxPrice": "string",
              "quarter": "string"
            }
          ]
        }
      ]
    }
  ],
  "page": {
    "currentPage": 0,
    "pageSize": 10,
    "totalElements": 100,
    "totalPages": 10,
    "first": true,
    "last": false,
    "hasNext": true,
    "hasPrevious": false
  }
}
```

### 参数说明

#### Content 字段说明

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| taskDataId | String | 任务数据ID |
| taskId | String | 任务ID |
| taskDetailId | String | 任务详情ID |
| materialName | String | 解析出的物资名称 |
| specifications | String | 解析出的规格 |
| unit | String | 解析出的单位 |
| quantity | String | 解析出的数量 |
| unitPrice | String | 解析出的单价 |
| taxPrice | String | 含税价格（税价） |
| totalPrice | String | 解析出的总价 |
| confirmResult | Integer | 确认结果（0：未确认，1：已确认） |
| confirmBaseDataId | String | 确认的基础数据ID |
| confirmPriceId | String | 确认的价格ID |
| confirmType | Integer | 确认类型（1：默认推荐确认，2：从待选列表选择确认，3：人工选择数据确认） |
| matchedType | Integer | 匹配类型（0：无匹配，1：精确匹配，2：相似匹配，3：历史匹配，4：人工匹配） |
| originalPrice | String | 原始价格 - 从Excel文件中读取的原始价格 |
| taxExcludedPrice | String | 不含税价格 - 计算得出的不含税价格 |
| priceType | Integer | 价格类型 - 标识原始价格的类型：1-含税价，0-不含税价 |
| createdTime | String | 创建时间 |
| updatedTime | String | 更新时间 |
| baseInfo | Object | 匹配的基础数据信息 |
| priceInfo | Object | 匹配的价格信息 |
| matchOptions | Array | 可选的匹配结果列表 |

#### BaseInfo 字段说明

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| baseDataId | String | 基础数据ID |
| materialName | String | 物资名称 |
| specifications | String | 规格型号 |
| unit | String | 单位 |
| serialNumber | String | 序号 |
| priceCode | String | 信息价编码 |
| materialCode | String | 物资编码 |
| type | String | 物资类型 |

#### PriceInfo 字段说明

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| priceId | String | 价格ID |
| baseDataId | String | 基础数据ID |
| taxPrice | String | 含税单价 |
| quarter | String | 价格季度 |

#### MatchOptions 字段说明

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| matchResultId | String | 匹配结果ID |
| matchedId | String | 匹配的基础数据ID |
| matchScore | Integer | 匹配分数 |
| matchType | Integer | 匹配类型（1：精确匹配，2：相似匹配，3：历史匹配） |
| baseInfo | Object | 基础数据信息 |
| priceOptions | Array | 可用价格列表 |

#### Page 字段说明

| 字段名 | 类型 | 说明 |
| --- | --- | --- |
| currentPage | Integer | 当前页码（从0开始） |
| pageSize | Integer | 每页大小 |
| totalElements | Long | 总记录数 |
| totalPages | Integer | 总页数 |
| first | Boolean | 是否为第一页 |
| last | Boolean | 是否为最后一页 |
| hasNext | Boolean | 是否有下一页 |
| hasPrevious | Boolean | 是否有上一页 |

## 错误响应

```json
{
  "code": 500,
  "message": "查询乙供物资解析结果失败: 具体错误信息",
  "data": null
}
```

## 版本更新说明 (v1.1.0)

### 性能优化
- 重构了查询逻辑，避免了复杂的JSON解析，直接使用Java对象处理，提高了查询性能
- 使用了Spring Data JPA的分页功能，优化了分页查询效率

### 功能增强
- 新增了当物资任务数据为已确认状态时，自动查询并返回确认的基础数据和价格数据的详细信息
- 保持了原有的所有筛选和搜索功能不变

### 兼容性
- 接口参数和返回值格式与之前版本完全一致，保证了向后兼容性